"use strict";(self.webpackChunkmy_hack_notes=self.webpackChunkmy_hack_notes||[]).push([[895],{9853:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var r=s(4848),i=s(8453);const t={sidebar_position:5},a=void 0,o={id:"Lame/SMB",title:"SMB",description:"Summary from nmap",source:"@site/docs/Lame/SMB.md",sourceDirName:"Lame",slug:"/Lame/SMB",permalink:"/Lame/SMB",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Lame/SMB.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"SSH",permalink:"/Lame/SSH"},next:{title:"vsftpd exploit",permalink:"/Lame/vsftpd exploit"}},l={},c=[{value:"Summary from nmap",id:"summary-from-nmap",level:3},{value:"Relevant information",id:"relevant-information",level:3},{value:"&#39;Vuln and Safe&#39; returns nothing",id:"vuln-and-safe-returns-nothing",level:3},{value:"Looking for enum scripts (nmap)",id:"looking-for-enum-scripts-nmap",level:3},{value:"Enumerating shares (nmap)",id:"enumerating-shares-nmap",level:3},{value:"Shared folders (nmap)",id:"shared-folders-nmap",level:3},{value:"Useful links",id:"useful-links",level:3},{value:"Shared folders (smbmap)",id:"shared-folders-smbmap",level:3},{value:"Connect and list content (smbclient)",id:"connect-and-list-content-smbclient",level:3},{value:"Looking for exploits",id:"looking-for-exploits",level:3}];function m(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"summary-from-nmap",children:"Summary from nmap"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"PORT     STATE SERVICE     VERSION\r\n139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\r\n445/tcp  open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)\r\n\r\nHost script results:\r\n|_clock-skew: mean: 2h00m28s, deviation: 2h49m45s, median: 25s\r\n|_smb2-time: Protocol negotiation failed (SMB2)\r\n| smb-security-mode: \r\n|   account_used: guest\r\n|   authentication_level: user\r\n| smb-os-discovery: \r\n|   OS: Unix (Samba 3.0.20-Debian)\r\n|   Computer name: lame\r\n|   Domain name: hackthebox.gr\r\n|   FQDN: lame.hackthebox.gr\r\n|_  System time: 2024-08-11T14:15:01-04:00\n"})}),"\n",(0,r.jsx)(n.h3,{id:"relevant-information",children:"Relevant information"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"samba 3.0.20"})}),"\n",(0,r.jsxs)(n.li,{children:["It does ",(0,r.jsx)(n.strong,{children:"NOT"})," support ",(0,r.jsx)(n.strong,{children:"SMB2"})]}),"\n",(0,r.jsxs)(n.li,{children:["login allowed as ",(0,r.jsx)(n.strong,{children:"guest"})," with no password"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"vuln-and-safe-returns-nothing",children:"'Vuln and Safe' returns nothing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'sudo nmap --script "vuln and safe" -p 445 lame.htb\n'})}),"\n",(0,r.jsx)(n.h3,{id:"looking-for-enum-scripts-nmap",children:"Looking for enum scripts (nmap)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"locate .nse | grep smb-enum\r\n/usr/share/nmap/scripts/smb-enum-domains.nse\r\n/usr/share/nmap/scripts/smb-enum-groups.nse\r\n/usr/share/nmap/scripts/smb-enum-processes.nse\r\n/usr/share/nmap/scripts/smb-enum-services.nse\r\n/usr/share/nmap/scripts/smb-enum-sessions.nse\r\n/usr/share/nmap/scripts/smb-enum-shares.nse\r\n/usr/share/nmap/scripts/smb-enum-users.nse\n"})}),"\n",(0,r.jsx)(n.h3,{id:"enumerating-shares-nmap",children:"Enumerating shares (nmap)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"sudo nmap --script smb-enum-shares -p 445 lame.htb -oA enum/smbEnumShares\n"})}),"\n",(0,r.jsx)(n.h3,{id:"shared-folders-nmap",children:"Shared folders (nmap)"}),"\n",(0,r.jsx)(n.p,{children:"Nmap output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"|   \\\\10.10.10.3\\tmp: \r\n|     Type: STYPE_DISKTREE\r\n|     Comment: oh noes!\r\n|     Users: 1\r\n|     Max Users: <unlimited>\r\n|     Path: C:\\tmp\r\n|_    Anonymous access: READ/WRITE\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useful-links",children:"Useful links"}),"\n",(0,r.jsx)(n.admonition,{title:"139,445 - Pentesting SMB (HackTricks)",type:"note",children:(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb",children:"https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb"})})}),"\n",(0,r.jsx)(n.h3,{id:"shared-folders-smbmap",children:"Shared folders (smbmap)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"smbmap -H lame.htb -r\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(8961).A+"",width:"981",height:"324"})}),"\n",(0,r.jsx)(n.h3,{id:"connect-and-list-content-smbclient",children:"Connect and list content (smbclient)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"smbclient --no-pass //lame.htb/tmp\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(6248).A+"",width:"792",height:"340"})}),"\n",(0,r.jsxs)(n.p,{children:["At this point you could receive some kind of error, remember what ",(0,r.jsx)(n.strong,{children:"nmap"})," told us:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"Protocol negotiation failed (SMB2)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["So if you get a message like ",(0,r.jsx)(n.strong,{children:"NT_STATUS_CONNECTION_DISCONNECTED"}),", you maybe need to edit your\xa0",(0,r.jsx)(n.code,{children:"/etc/samba.smb.conf"}),"\xa0file like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[global]\r\nclient min protocol=NT1\n"})}),"\n",(0,r.jsxs)(n.p,{children:["An alternative way to do this could be adding the following option to the ",(0,r.jsx)(n.strong,{children:"smbclient"})," command line:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"--option='client min protocol=NT1'"})}),"\n",(0,r.jsx)(n.h3,{id:"looking-for-exploits",children:"Looking for exploits"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"searchsploit samba 3.0\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"'Username' map script"})," looks interesting"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(739).A+"",width:"848",height:"388"})})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},8961:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/lame-004-20c25626220d5d7879864e71d96503ce.png"},6248:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/lame-005-459556ec8e18b77e62b0eb6b6b3f8a95.png"},739:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/lame-006-2098a926bd3552e2b7dcf29a214d9aeb.png"},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);